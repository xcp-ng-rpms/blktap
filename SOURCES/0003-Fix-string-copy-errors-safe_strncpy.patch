From 250e410a369f8ec2dbc0730815d8eb908c140873 Mon Sep 17 00:00:00 2001
From: Anthoine Bourgeois <anthoine.bourgeois@vates.tech>
Date: Fri, 17 Jan 2025 09:21:01 +0100
Subject: [PATCH] Fix string copy errors (safe_strncpy)

Errors come from -Wstringop-truncation with gcc-8 and above.

Signed-off-by: Anthoine Bourgeois <anthoine.bourgeois@vates.tech>
---
 include/util.h | 8 +++-----
 1 file changed, 3 insertions(+), 5 deletions(-)

diff --git a/include/util.h b/include/util.h
index e2529a51..c0736902 100644
--- a/include/util.h
+++ b/include/util.h
@@ -32,6 +32,7 @@
 #define __TAPDISK_UTIL_H_
 
 #include <stddef.h>
+#include <stdio.h>
 #include <string.h>
 
 #define ARRAY_SIZE(_a) (sizeof(_a)/sizeof((_a)[0]))
@@ -42,11 +43,8 @@
 static inline char *
 safe_strncpy(char *dest, const char *src, size_t n)
 {
-	char *pdest;
-	pdest = strncpy(dest, src, n - 1);
-	if (n > 0)
-		dest[n - 1] = '\0';
-	return pdest;
+	snprintf(dest, n, "%s", src);
+	return dest;
 }
 
 #endif /* __TAPDISK_UTIL_H__ */
